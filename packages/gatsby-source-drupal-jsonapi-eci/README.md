# Drupal content sourcing (`gatsby-source-drupal-jsonapi-eci`)

Started off [`gatsby-source-drupal`](https://www.gatsbyjs.org/packages/gatsby-source-drupal/) plugin.

## Differences

- All languages of an API are fetched through 1 plugin configuration, not several.
- Accepts `languages` (array) so that all translations are available in once place before Gatsby's `createNode()`.
- IDs are namespaced with `language` and `apiBase`, avoiding overrides because of same IDs generated by `createNodeId()` passed by `sourceNodes()`.
- Does not work with attachments, i.e. no Files

## Reasoning

- JSON API module in Drupal 8 has [issues with multilingualism](https://www.drupal.org/project/issues/jsonapi?text=translations&status=Open&priorities=All&categories=All&version=All&component=All)
- Hard to pass per-node list of available translations from Drupal. (Normalizer pattern has been deprecated in JSON API module and the new Field Enhancer Plugin does not cover for the scenario to add translations in node's `attributes` in JSON API responses. Adding the list of translations in a computed field is also not optimal because values are calculated on each entity load.

## Notes

It's not straight-forward to make a Gatsby site work without data matching to GraphQL queries. When the latter asks for data which is not available, an exception is thrown and the site can't be built.

For this reason, to be able to build a Gatsby site based on Drupal backend:

- Backend (Drupal) needs to provide at least 1 node of each content type used in the website: OE news, pages, etc.
- This required at-least-one node, should have a Pathauto alias, containing `langcode` and `alias`, starting with a slash.

Based on this, Gatsby site will be able to create at least one page for the required data requirements (GraphQL). Missing translations will fallback to default one, which has already been created.

For example, to start the website, one needs to have at least 1 page `/en/how-it-works` and if there are no translations, going to `/bg/how-it-works` Gatsby site will display the English content until there is an actual one.
